<!DOCTYPE html>
<html lang="en">
<head>
  <!--
    Micromoon — Deluxe Cosmic UI
    - All required #ids preserved for app.js:
      #stars #deepPhrase #tagline #moodPicker #note #useMyLocation #toggleCrosshair
      #chosenSpot #connectConsent #submitMood #shareLink #ui-* #toggleConnections
      #windowHours #radiusKm #radiusValue #toggleHeat #toggleCluster #crosshair #map
      #toastHost .lang-btn[data-lang] #moonBadge #moonLabel #toggleMotion
    - No backend changes. Safe drop-in.
  -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Micromoon — anonymous, 24-hour moods</title>

  <!-- OpenGraph / Twitter -->
  <meta property="og:title" content="Micromoon — anonymous, 24-hour moods">
  <meta property="og:description" content="Under the same sky, our moods become lights on a shared map for 24 hours.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="/og-card.jpg">
  <meta property="og:url" content="https://micromoon.onrender.com">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;900&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- Leaflet + plugins -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

  <style>
    /* ----------------------------- Root palette & resets */
    :root{
      --bg:#040d1c;
      --bg-2:#06152b;
      --panel:#0a1e3b;
      --panel-2:#0b1a34;
      --ink:#eaf1ff;
      --muted:#a6b6cf;
      --line:rgba(255,255,255,.14);
      --glass:rgba(255,255,255,.06);
      --glass-2:rgba(255,255,255,.09);
      --brand:#b6d3ff;
      --accent:#67a4ff;
      --accent-2:#8fe1ff;
      --hot:#ff81a7;
      --ok:#9bffdb;
      --warn:#ffd189;
      --shadow:0 18px 60px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink);
      font-family:"Outfit",system-ui,-apple-system,Segoe UI,Inter,Roboto,Helvetica,Arial;
      background:
        radial-gradient(1200px 800px at 40% -10%, #0d1e3a 0%, #08162e 55%, var(--bg) 100%);
      overflow-x:hidden;
    }
    a{color:var(--brand); text-decoration:none}
    ::selection{ background:#284b86; color:#fff }

    /* ----------------------------- Cosmic background stack */
    #stars{ position:fixed; inset:0; z-index:0; pointer-events:none; }
    .parallax-sky{
      position:fixed; inset:-10vh -10vw; z-index:0; pointer-events:none;
      background:
        radial-gradient(60% 35% at 20% 15%, rgba(118,191,255,.16), transparent 60%),
        radial-gradient(55% 45% at 80% 10%, rgba(172,137,255,.12), transparent 60%),
        radial-gradient(50% 40% at 70% 70%, rgba(92,255,219,.10), transparent 60%);
      filter: blur(40px) saturate(120%);
      animation: aurora 18s ease-in-out infinite alternate;
      mix-blend-mode:screen;
    }
    @keyframes aurora {
      0%{ transform: translate3d(-1%, -1%, 0) scale(1); opacity:.78 }
      100%{ transform: translate3d(1%, 2%, 0) scale(1.03); opacity:.95 }
    }

    /* Constellation overlay (thin lines) */
    .constellations{
      position:fixed; inset:0; pointer-events:none; z-index:0;
      opacity:.22; mix-blend-mode:screen;
    }
    .constellations svg{ width:100%; height:100%; display:block }

    /* ----------------------------- Layout containers */
    .container{max-width:1260px; margin:0 auto; padding:28px; position:relative; z-index:1}
    header{
      display:flex; align-items:center; gap:18px; justify-content:space-between; margin-bottom:12px;
    }

    /* ----------------------------- Logo (animated SVG) */
    .logo{
      display:flex; align-items:center; gap:12px; text-decoration:none; color:var(--ink);
    }
    .logo svg{ width:44px; height:44px; filter:drop-shadow(0 6px 24px rgba(150,200,255,.3)); }
    .logo .word{
      font-weight:900; letter-spacing:.4px; font-size:22px;
      background: linear-gradient(90deg, #d0e1ff, #8ec5ff 35%, #d0e1ff 70%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      animation: shimmer 6s linear infinite; background-size:200% 100%;
    }
    @keyframes shimmer { 0%{ background-position:200% 0 } 100%{ background-position:-200% 0 } }

    /* ----------------------------- Top controls (lang, phase, motion) */
    .top-controls{
      display:flex; align-items:center; gap:12px; margin-left:auto;
    }
    .badge{
      display:flex; align-items:center; gap:8px; font-size:12px; padding:8px 12px;
      background:var(--glass); backdrop-filter: blur(8px); border:1px solid var(--line);
      border-radius:12px;
    }
    .langbar{
      background:var(--glass); border:1px solid var(--line); border-radius:14px;
      padding:6px; display:flex; gap:4px; backdrop-filter: blur(8px);
    }
    .lang-btn{
      border:0; padding:6px 10px; border-radius:10px; color:var(--ink);
      background:transparent; cursor:pointer; font-weight:700; font-size:12px; opacity:.85;
      transition: all .2s ease;
    }
    .lang-btn:hover{ opacity:1; background:rgba(255,255,255,.12) }
    .lang-btn.active{ background:rgba(255,255,255,.18); opacity:1; box-shadow: inset 0 0 0 1px rgba(255,255,255,.14); }
    .toggle{ display:flex; align-items:center; gap:8px; font-size:12px; opacity:.9; }
    .toggle input{ accent-color:#6aa7ff; width:18px; height:18px }

    /* ----------------------------- Hero */
    .hero{
      margin-top:10px; margin-bottom:20px; position:relative;
      display:grid; grid-template-columns: 1.2fr .8fr; gap:20px;
    }
    @media (max-width: 1020px){ .hero{ grid-template-columns: 1fr; } }

    .hero-left{
      padding:22px; background:linear-gradient(180deg, var(--glass-2), rgba(255,255,255,.05));
      border:1px solid var(--line); border-radius:22px; box-shadow: var(--shadow);
      position:relative; overflow:hidden;
    }
    .hero-left:after{
      content:""; position:absolute; inset: -40% -60%;
      background: radial-gradient(40% 30% at 60% 0%, rgba(255,255,255,.08), transparent 60%);
      transform: rotate(12deg);
    }
    #tagline{
      margin: 0 0 8px 4px; color:var(--muted); font-size:14px; letter-spacing:.4px;
      text-transform:uppercase;
    }
    #deepPhrase{
      font-size:clamp(28px, 5vw, 56px); line-height:1.05; letter-spacing:-.02em; font-weight:900;
      text-wrap:balance; text-shadow:0 2px 0 rgba(0,0,0,.2);
    }
    #deepPhrase .line{ display:block; opacity:0; transform: translateY(10px); animation: rise .72s cubic-bezier(.2,.9,.23,1) forwards; }
    #deepPhrase .line:nth-child(1){ animation-delay:.05s } #deepPhrase .line:nth-child(2){ animation-delay:.18s } #deepPhrase .line:nth-child(3){ animation-delay:.32s }
    @keyframes rise { to { opacity:1; transform: translateY(0) } }
    .brand-gradient{
      background: linear-gradient(90deg, #d7e7ff, #8ec5ff 30%, #d7e7ff 60%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      animation: shimmer 5.5s linear infinite; background-size:200% 100%;
    }

    .hero-right{
      display:grid; gap:14px;
      grid-template-rows: auto 1fr;
    }

    .hero-stats{
      background:linear-gradient(180deg, var(--glass-2), rgba(255,255,255,.05));
      border:1px solid var(--line); border-radius:22px; box-shadow: var(--shadow);
      padding:16px 18px; display:flex; align-items:center; gap:14px;
    }
    .stat{ display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px }
    #spark{ width:140px; height:28px; display:block }

    .legend{
      display:flex; align-items:center; gap:12px; flex-wrap:wrap; font-size:13px; color:var(--muted);
    }
    .legend .pill{ display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:var(--glass); border:1px solid var(--line) }
    .pill .dot{ width:10px; height:10px; border-radius:999px; display:inline-block }
    .d-neg2{ background:#8ebeff } .d-neg1{ background:#b5ccff } .d-0{ background:#dee7ff } .d-pos1{ background:#9bffdb } .d-pos2{ background:#67ffb0 }

    /* ----------------------------- Panels (Composer + Controls) */
    .grid{ display:grid; grid-template-columns: 1.1fr .9fr; gap:20px; }
    @media (max-width: 1020px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      position:relative; z-index:1;
      background:linear-gradient(180deg, var(--glass-2), rgba(255,255,255,.05));
      border:1px solid var(--line);
      border-radius:22px; padding:20px; box-shadow: var(--shadow);
    }
    .card h3{ margin:0 0 8px 0; font-size:18px; letter-spacing:.2px }
    .muted{ color:var(--muted) }

    /* Composer */
    .composer textarea{
      width:100%; min-height:120px; resize:vertical;
      background:rgba(0,0,0,.25); border:1px solid var(--line);
      border-radius:16px; color:var(--ink); padding:12px; font:inherit;
      box-shadow: inset 0 8px 30px rgba(0,0,0,.15);
    }
    .btn{
      appearance:none; border:0; border-radius:16px; padding:12px 18px; font-weight:800; letter-spacing:.2px;
      background:#fff; color:#0a172e; cursor:pointer; box-shadow: 0 10px 26px rgba(0,0,0,.4);
      transition: transform .06s ease, box-shadow .2s ease;
    }
    .btn:hover{ transform: translateY(-1px) }
    .btn.secondary{ background:#203a67; color:#e5edff; border:1px solid var(--line) }
    .btn:disabled{ opacity:.5; cursor:not-allowed }

    /* Map */
    #map{ width:100%; height:560px; border-radius:18px; overflow:hidden; border:1px solid var(--line) }
    #crosshair{ position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); pointer-events:none; border:1px dashed rgba(255,255,255,.28); width:44px; height:44px; border-radius:8px; }
    .hidden{ display:none }

    /* Info sections */
    .info-grid{ display:grid; grid-template-columns: repeat(3,1fr); gap:20px; margin-top:20px; }
    @media (max-width: 980px){ .info-grid{ grid-template-columns: 1fr; } }
    .info-card{ background:linear-gradient(180deg, var(--glass-2), rgba(255,255,255,.05)); border:1px solid var(--line); border-radius:18px; padding:16px 18px; box-shadow: var(--shadow); }
    .info-card h4{ margin:0 0 6px 0; font-size:16px }
    .info-card p{ margin:6px 0; color:var(--muted); line-height:1.5 }

    details{ background:rgba(255,255,255,.04); border:1px solid var(--line); padding:12px 14px; border-radius:14px }
    summary{ cursor:pointer; font-weight:800 }

    /* Footer */
    footer{ margin:26px 0 40px; display:flex; align-items:center; justify-content:space-between; color:var(--muted) }
    .credits{ font-size:13px }
    .credits strong{ color:var(--ink) }

    /* Toasts */
    #toastHost{ position: fixed; bottom: 18px; left: 50%; transform: translateX(-50%); display: grid; gap:10px; z-index: 50; }

    /* Reduce motion */
    .reduce-motion #deepPhrase .line,
    .reduce-motion .brand-gradient,
    .reduce-motion .parallax-sky,
    .reduce-motion .constellations{ animation:none }
  </style>
</head>
<body>
  <!-- Background layers -->
  <canvas id="stars"></canvas>
  <div class="parallax-sky" aria-hidden="true"></div>
  <div class="constellations" aria-hidden="true">
    <!-- minimalist constellation strokes -->
    <svg viewBox="0 0 100 100" preserveAspectRatio="none">
      <g stroke="rgba(182,211,255,.24)" stroke-width=".15" fill="none">
        <path d="M5 20 L15 35 L32 28 L48 45 L60 40 L72 55 L85 42" />
        <circle cx="5" cy="20" r=".6"/><circle cx="15" cy="35" r=".6"/><circle cx="32" cy="28" r=".6"/>
        <circle cx="48" cy="45" r=".6"/><circle cx="60" cy="40" r=".6"/><circle cx="72" cy="55" r=".6"/><circle cx="85" cy="42" r=".6"/>
        <path d="M12 78 L24 72 L46 86 L64 70 L88 82" />
        <circle cx="12" cy="78" r=".6"/><circle cx="24" cy="72" r=".6"/><circle cx="46" cy="86" r=".6"/>
        <circle cx="64" cy="70" r=".6"/><circle cx="88" cy="82" r=".6"/>
      </g>
    </svg>
  </div>

  <div class="container">
    <!-- Header -->
    <header>
      <a class="logo" href="/" aria-label="Micromoon home">
        <!-- Animated crescent logo -->
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="crescent moon">
          <defs>
            <radialGradient id="g1" cx="40%" cy="40%">
              <stop offset="0%" stop-color="#e7f0ff"/>
              <stop offset="60%" stop-color="#bcd7ff"/>
              <stop offset="100%" stop-color="#8fb9ff"/>
            </radialGradient>
            <filter id="glow" x="-40%" y="-40%" width="180%" height="180%">
              <feGaussianBlur stdDeviation="2.8" result="b"/>
              <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          <circle cx="32" cy="32" r="18" fill="url(#g1)" filter="url(#glow)"/>
          <circle cx="38" cy="26" r="18" fill="#040d1c"/>
        </svg>
        <div class="word">Micromoon</div>
      </a>

      <div class="top-controls">
        <div class="badge" id="moonBadge">🌖 <span id="moonLabel">Moon phase</span></div>
        <div class="badge toggle"><input type="checkbox" id="toggleMotion"><label for="toggleMotion">Reduce motion</label></div>
        <div class="langbar" id="langbar" role="group" aria-label="Language">
          <button class="lang-btn" data-lang="en">EN</button>
          <button class="lang-btn" data-lang="de">DE</button>
          <button class="lang-btn" data-lang="es">ES</button>
          <button class="lang-btn" data-lang="fr">FR</button>
          <button class="lang-btn" data-lang="ar">AR</button>
          <button class="lang-btn" data-lang="ru">RU</button>
          <button class="lang-btn" data-lang="zh">中文</button>
        </div>
      </div>
    </header>

    <!-- Hero -->
    <section class="hero">
      <div class="hero-left">
        <p id="tagline" class="muted">Micromoon — anonymous, 24-hour moods</p>
        <div id="deepPhrase"></div>
      </div>

      <div class="hero-right">
        <div class="hero-stats">
          <div class="stat"><span id="liveCount">Now: 0 pulses</span></div>
          <canvas id="spark" width="140" height="28" aria-label="activity sparkline"></canvas>
        </div>
        <div class="legend">
          <div class="pill"><span class="dot d-neg2"></span> very low</div>
          <div class="pill"><span class="dot d-neg1"></span> low</div>
          <div class="pill"><span class="dot d-0"></span> neutral</div>
          <div class="pill"><span class="dot d-pos1"></span> good</div>
          <div class="pill"><span class="dot d-pos2"></span> great</div>
          <div class="pill">⎯ glows = fresh</div>
        </div>
      </div>
    </section>

    <!-- Panels -->
    <section class="grid">
      <!-- Composer -->
      <div class="card composer" aria-labelledby="ui-pulseTitle">
        <h3 id="ui-pulseTitle">Pulse your mood</h3>
        <p id="ui-howFeel" class="muted">How do you feel?</p>

        <div id="moodPicker" style="display:flex; gap:10px; margin:10px 0 14px;">
          <button class="btn secondary" data-mood="-2" aria-label="very low">😢</button>
          <button class="btn secondary" data-mood="-1" aria-label="low">🙁</button>
          <button class="btn secondary" data-mood="0" aria-label="neutral">😐</button>
          <button class="btn secondary" data-mood="1" aria-label="good">🙂</button>
          <button class="btn secondary" data-mood="2" aria-label="great">🤩</button>
        </div>

        <p class="muted"><span id="ui-whatsHappening">What’s happening?</span> <span id="ui-optional">(optional, 280 chars)</span></p>
        <textarea id="note" placeholder="A few words you want to share..."></textarea>

        <div style="display:flex; gap:10px; align-items:center; margin:14px 0;">
          <button class="btn secondary" id="useMyLocation">Use my location</button>
          <span class="muted" id="ui-orClickMap">or click on the map</span>
          <button class="btn secondary" id="toggleCrosshair">Crosshair ⌖</button>
        </div>

        <div class="muted" id="chosenSpot" aria-live="polite">No spot selected yet.</div>

        <label style="display:flex; align-items:center; gap:8px; margin:12px 0;">
          <input type="checkbox" id="connectConsent" />
          <span id="ui-allowConnect">Allow others to connect my dot</span>
        </label>

        <div style="display:flex; gap:10px; margin-top:8px;">
          <button class="btn" id="submitMood" disabled>Pulse</button>
          <button class="btn secondary" id="shareLink" disabled>Share</button>
        </div>
        <p class="muted" id="ui-postsInfo" style="margin-top:10px;">Posts are anonymous and visible for 24 hours, then disappear.</p>
      </div>

      <!-- Map Controls -->
      <div class="card">
        <h3>Map view</h3>

        <label style="display:flex; gap:8px; align-items:center; margin:10px 0;">
          <input type="checkbox" id="toggleConnections" />
          <span>Connect similar moods</span>
        </label>

        <div class="mm-controls" style="display:flex; gap:22px; align-items:center; flex-wrap:wrap;">
          <div style="display:flex; align-items:center; gap:10px;">
            <span id="ui-window">Window</span>
            <select id="windowHours" class="btn secondary" aria-label="time window">
              <option value="24" id="ui-24h">24h</option>
              <option value="12" id="ui-12h">12h</option>
              <option value="6" id="ui-6h">6h</option>
            </select>
          </div>

          <div style="display:flex; align-items:center; gap:10px;">
            <span id="ui-radius">Radius</span>
            <input id="radiusKm" type="range" min="20" max="300" step="1" value="120" />
            <span id="radiusValue">120km</span>
          </div>

          <label style="display:flex; gap:8px; align-items:center;">
            <input type="checkbox" id="toggleHeat" /> Heatmap
          </label>
          <label style="display:flex; gap:8px; align-items:center;">
            <input type="checkbox" id="toggleCluster" checked /> Cluster
          </label>
        </div>

        <p class="muted" style="margin-top:10px;">Tip: lower the window to 6–12h to see fresher activity.</p>

        <!-- Decorative mini-about in controls card -->
        <div class="info-grid">
          <div class="info-card">
            <h4>Anonymous</h4>
            <p>No login. Just the sky, a dot, and a feeling.</p>
          </div>
          <div class="info-card">
            <h4>Ephemeral</h4>
            <p>Dots glow for 24 hours then fade into the night.</p>
          </div>
          <div class="info-card">
            <h4>Connection</h4>
            <p>Turn on “connect similar” to see lines between nearby moods.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Map Card -->
    <section class="card" style="margin-top:20px; position:relative;">
      <div id="crosshair" class="hidden" aria-hidden="true"></div>
      <div id="map"></div>
    </section>

    <!-- Expanded Info / Story / FAQ for depth & polish -->
    <section class="info-grid" style="margin-top:20px;">
      <div class="info-card">
        <h4>Why Micromoon?</h4>
        <p>Because the same moon looks down on all of us. Your dot is a small light in a shared sky. Sometimes that’s enough.</p>
        <details style="margin-top:8px;">
          <summary>How it works</summary>
          <p>Pick a place or use your location. Choose a mood. Add a short note if you want. Your dot appears for 24 hours. That’s it.</p>
        </details>
      </div>
      <div class="info-card">
        <h4>Privacy</h4>
        <p>There are no accounts here. Please avoid sharing private details in notes. Keep it kind. Keep it human.</p>
        <details style="margin-top:8px;">
          <summary>Safety tips</summary>
          <p>Share in broad strokes. If you’re struggling, consider local hotlines or trusted contacts. You’re not alone under this sky.</p>
        </details>
      </div>
      <div class="info-card">
        <h4>Connect</h4>
        <p>Enable “connect similar” to see gentle lines between nearby dots with the same mood. Optional. Your choice.</p>
        <details style="margin-top:8px;">
          <summary>Ideas</summary>
          <p>Try focusing the window to 6 hours and watch what happens at night in your city.</p>
        </details>
      </div>
    </section>

    <!-- FAQ block to enrich content and keep single-file -->
    <section class="card" style="margin-top:20px;">
      <h3>FAQ</h3>
      <details open>
        <summary>Do I need an account?</summary>
        <p>No. You post as a guest. We only store your mood, optional note, coordinates, and time.</p>
      </details>
      <details>
        <summary>How long do posts stay?</summary>
        <p>For 24 hours on the map. Then they disappear, like a passing cloud.</p>
      </details>
      <details>
        <summary>Can people see exactly where I am?</summary>
        <p>Your dot shows the location you choose. If you prefer, click somewhere nearby instead of your exact spot.</p>
      </details>
      <details>
        <summary>Who made this?</summary>
        <p>Built by <strong>Mouaz Almjarkesh</strong>. Designed for quiet connection under a shared sky.</p>
      </details>
    </section>

    <!-- Footer -->
    <footer>
      <div class="credits">© <span id="year"></span> <strong>Micromoon</strong>. Built by <strong>Mouaz Almjarkesh</strong>.</div>
      <div class="credits">Under the same sky.</div>
    </footer>
  </div>

  <!-- Toast host -->
  <div id="toastHost"></div>

  <!-- App logic (front-end only; backend unchanged) -->
  <script>
    // keep copyright current
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
  <script src="/app.js"></script>
</body>
</html>
