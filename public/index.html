<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Micromoon ‚Äî anonymous, 24-hour moods</title>

  <!-- Leaflet + plugins (unchanged) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,300;14..32,500;14..32,700;14..32,800&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --bg:#0a1431; --bg2:#071124;
      --card:#0e2144cc; --stroke:rgba(255,255,255,.12);
      --text:#eaf1ff; --muted:#b8c9ee;
      --brand1:#a9d6ff; --brand2:#63ffd1; --accent:#69ffd3;
      --shadow:0 22px 60px rgba(0,0,0,.45);
      --radius:22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1300px 900px at 75% 65%, #0d3160 0%, var(--bg) 45%, var(--bg2) 100%);
      overflow-x:hidden;
    }

    /* sky layers */
    .layer{position:fixed; inset:0; pointer-events:none}
    #stars{position:fixed; inset:0; z-index:1; pointer-events:none}
    .aurora{
      z-index:0;
      background:
        radial-gradient(1200px 420px at 25% 25%, rgba(120,255,230,.15), transparent 55%),
        radial-gradient(1000px 380px at 80% 75%, rgba(120,190,255,.12), transparent 60%),
        conic-gradient(from 210deg at 50% 50%, rgba(104,255,208,.06), rgba(0,0,0,0) 65%, rgba(160,220,255,.10));
      filter: blur(42px) saturate(115%);
      animation: drift 22s linear infinite alternate;
    }
    .nebula{
      z-index:0;
      background-image:
        radial-gradient(800px 600px at 60% 40%, rgba(40,140,255,.08), transparent 60%),
        radial-gradient(700px 500px at 30% 70%, rgba(110,70,200,.08), transparent 60%),
        radial-gradient(900px 700px at 90% 10%, rgba(255,180,120,.05), transparent 70%);
      mix-blend-mode: screen; filter: blur(10px);
      animation: drift2 30s linear infinite alternate;
    }
    @keyframes drift{to{transform:translateY(-1.5%) translateX(1%)}}
    @keyframes drift2{to{transform:translateY(1.3%) translateX(-1%)}}

    /* shooting stars */
    .meteors{z-index:2}
    .meteors:before,.meteors:after{
      content:""; position:absolute; width:2px; height:2px; background:#fff; border-radius:50%;
      box-shadow:0 0 10px 2px rgba(255,255,255,.8),0 0 22px 6px rgba(160,220,255,.4);
      animation: shoot 7s linear infinite;
    }
    .meteors:after{ animation-delay:3.5s; left:68%; top:18% }
    .meteors:before{ left:18%; top:70% }
    @keyframes shoot{
      0%{opacity:0; transform:translate(0,0)}
      10%{opacity:1}
      55%{opacity:.85; transform:translate(260px,-160px)}
      100%{opacity:0; transform:translate(520px,-320px)}
    }

    .page{position:relative; z-index:3; max-width:1200px; margin:0 auto; padding:24px clamp(14px,2vw,20px) 110px}

    /* top bar */
    .top{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      position:sticky; top:0; padding:8px 0 12px; backdrop-filter:blur(8px); z-index:9;
    }
    .brand{
      display:flex; gap:12px; align-items:center; padding:8px 12px;
      border-radius:14px; background:linear-gradient(180deg, rgba(15,34,68,.7), rgba(10,22,46,.5));
      border:1px solid var(--stroke); box-shadow:var(--shadow);
      transform:translateZ(0);
    }
    .brand strong{font-weight:800; letter-spacing:.3px; font-size:18px}
    .logoWrap{position:relative; width:28px; height:28px}
    .moon{position:absolute; inset:0}
    .sat{position:absolute; left:50%; top:50%; width:6px; height:6px; margin:-3px; background:#fff; border-radius:50%;
      box-shadow:0 0 12px 2px rgba(255,255,255,.65);
      animation: orbit 10s linear infinite}
    @keyframes orbit{from{transform:rotate(0deg) translateX(18px) rotate(0)} to{transform:rotate(360deg) translateX(18px) rotate(-360deg)}}

    .badge,.switch,.lang{
      display:flex; align-items:center; gap:10px;
      background:linear-gradient(180deg, rgba(15,34,68,.7), rgba(10,22,46,.5));
      border:1px solid var(--stroke); border-radius:14px; padding:8px 12px; box-shadow:var(--shadow);
    }
    .lang{gap:8px; flex-wrap:wrap}
    .lang-btn{background:transparent; color:var(--text); border:1px solid transparent; padding:8px 10px; border-radius:12px; cursor:pointer; font-weight:800}
    .lang-btn.active{background:#163261; border-color:var(--stroke)}

    /* hero */
    .hero{
      margin-top:10px; position:relative; overflow:hidden;
      border:1px solid var(--stroke); border-radius:26px; box-shadow:var(--shadow);
      background:linear-gradient(180deg, rgba(15,34,68,.72), rgba(10,22,46,.58));
      padding: clamp(24px, 3vw, 40px);
    }
    .hero:before{
      content:""; position:absolute; inset:-2px; border-radius:inherit;
      background:radial-gradient(800px 160px at 12% -5%, rgba(160,220,255,.16), transparent 40%);
      pointer-events:none;
    }
    #deepPhrase{
      font-weight:800; font-size:clamp(28px,4.2vw,46px); line-height:1.05; letter-spacing:-.02em; text-wrap:balance;
    }
    .brand-gradient{
      background: linear-gradient(90deg, var(--brand1), var(--brand2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow:0 1px 0 rgba(0,0,0,.35)
    }

    /* constellation mesh that follows the cursor */
    .mesh{position:absolute; inset:0; pointer-events:none; opacity:.35}
    .mesh svg{width:100%; height:100%}
    .mesh .line{stroke:#cfe3ff; stroke-opacity:.35; stroke-width:1; stroke-dasharray:5 6}
    .mesh .star{fill:#fff; opacity:.8}

    .infocards{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:14px; margin-top:14px}
    .pill{border:1px solid var(--stroke); background:var(--card); border-radius:16px; padding:12px 14px; color:var(--muted); font-weight:600; text-align:center}

    /* controls */
    .controls{display:grid; grid-template-columns:1fr 1fr; gap:18px; margin-top:22px}
    .card{border:1px solid var(--stroke); background:var(--card); border-radius:26px; box-shadow:var(--shadow); padding:18px clamp(14px,2vw,20px); transform-style:preserve-3d; will-change:transform}
    .card h2,.card h3{margin:0 0 10px; letter-spacing:.02em}
    .card h2{font-size:clamp(18px,2.1vw,22px)}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .help{color:var(--muted); font-size:14px}

    /* legend */
    .legend{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .chip{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; border:1px solid var(--stroke); background:#0e2247ad; font-weight:700; color:#eaf1ff; box-shadow: inset 0 0 18px rgba(255,255,255,.06)}
    .dot{width:9px; height:9px; border-radius:50%; box-shadow: 0 0 12px currentColor}

    /* inputs */
    #moodPicker{display:flex; gap:10px; flex-wrap:wrap}
    #moodPicker button{font-size:20px; line-height:1; padding:8px 10px; border-radius:12px; background:#162b55; color:var(--text); border:1px solid var(--stroke); cursor:pointer; transition:.18s ease}
    #moodPicker button.active{outline:2px solid var(--accent); background:#0d2246}
    textarea{width:100%; min-height:110px; resize:vertical; border-radius:14px; border:1px solid var(--stroke); background:#0d1d3e; color:var(--text); padding:12px 14px; font:inherit}
    .btn{appearance:none; border:1px solid var(--stroke); background:#2b3f6b; color:#fff; padding:10px 14px; border-radius:14px; cursor:pointer; font-weight:800}
    .btn.primary{background:#fff; color:#0e2147}
    .btn:disabled{opacity:.55; cursor:not-allowed}
    label.checkbox{display:flex; gap:10px; align-items:center; user-select:none}
    input[type="checkbox"]{width:18px; height:18px; accent-color:#69ffd3}

    .range{display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:center}
    input[type="range"]{width:100%}

    /* map */
    .mapWrap{margin-top:20px}
    #map{width:100%; height:clamp(420px,52vh,600px); border-radius:26px; overflow:hidden; border:1px solid var(--stroke); box-shadow:var(--shadow)}
    #crosshair{position:absolute; inset:auto 0 0 0; height:0}
    #crosshair.hidden{display:none}

    /* story / about */
    .story{
      margin-top:36px; padding:26px clamp(14px,2vw,20px);
      border:1px solid var(--stroke); border-radius:26px;
      background:linear-gradient(180deg, rgba(15,34,68,.72), rgba(10,22,46,.58));
      box-shadow:var(--shadow);
    }
    .story h2{margin:0 0 8px; font-size:clamp(18px,2vw,22px)}
    .story p{margin:8px 0; color:#e9efff}
    .steps{display:grid; grid-template-columns:repeat(3,1fr); gap:14px; margin-top:12px}
    .step{border:1px solid var(--stroke); border-radius:18px; padding:14px; background:#0f2244b5}
    .step h3{margin:0 0 6px; font-size:16px}
    .footer{display:flex; justify-content:space-between; align-items:center; gap:14px; margin-top:14px; color:var(--muted); font-size:14px}

    /* mobile */
    @media (max-width:960px){
      .controls{grid-template-columns:1fr}
      .infocards,.steps{grid-template-columns:1fr}
      .top{flex-wrap:wrap; gap:10px}
      #map{height:64vh}
    }

    /* reduce motion kills fancy bits */
    .reduce-motion *{animation:none !important; transition:none !important}
  </style>
</head>
<body>
  <!-- background -->
  <div class="layer aurora"></div>
  <div class="layer nebula"></div>
  <div class="layer meteors"></div>
  <canvas id="stars"></canvas>

  <div class="page">
    <!-- top bar -->
    <div class="top">
      <div class="brand" id="logoBrand" title="Micromoon">
        <div class="logoWrap" aria-hidden="true">
          <!-- crescent with moving mask -->
          <svg class="moon" viewBox="0 0 64 64">
            <defs>
              <radialGradient id="g" cx="40%" cy="40%">
                <stop offset="0%" stop-color="#f5fbff"/>
                <stop offset="100%" stop-color="#cde7ff"/>
              </radialGradient>
              <mask id="cres">
                <rect width="64" height="64" fill="white"/>
                <circle id="masker" cx="44" cy="28" r="22" fill="black">
                  <animate attributeName="cx" values="44;40;44" dur="8s" repeatCount="indefinite"/>
                  <animate attributeName="cy" values="28;26;28" dur="8s" repeatCount="indefinite"/>
                </circle>
              </mask>
            </defs>
            <circle cx="32" cy="32" r="22" fill="url(#g)" mask="url(#cres)"/>
          </svg>
          <div class="sat"></div>
        </div>
        <strong>Micromoon</strong>
      </div>

      <div class="badge"><span>üåï</span><span id="moonLabel">Moon phase</span></div>

      <div class="switch">
        <label class="row" style="gap:8px;">
          <input id="toggleMotion" type="checkbox"/>
          <span>Reduce motion</span>
        </label>
      </div>

      <div class="lang">
        <button class="lang-btn active" data-lang="en">EN</button>
        <button class="lang-btn" data-lang="de">DE</button>
        <button class="lang-btn" data-lang="es">ES</button>
        <button class="lang-btn" data-lang="fr">FR</button>
        <button class="lang-btn" data-lang="ar">AR</button>
        <button class="lang-btn" data-lang="ru">RU</button>
        <button class="lang-btn" data-lang="zh">‰∏≠Êñá</button>
      </div>
    </div>

    <!-- hero -->
    <section class="hero" aria-label="intro">
      <div id="deepPhrase" aria-live="polite"></div>

      <!-- constellation mesh -->
      <div class="mesh" aria-hidden="true">
        <svg viewBox="0 0 1200 420" preserveAspectRatio="none">
          <g id="meshGroup">
            <!-- stars -->
            <circle class="star" cx="120" cy="120" r="2"/>
            <circle class="star" cx="240" cy="170" r="2"/>
            <circle class="star" cx="340" cy="110" r="2"/>
            <circle class="star" cx="820" cy="210" r="2"/>
            <circle class="star" cx="910" cy="140" r="2"/>
            <circle class="star" cx="1020" cy="200" r="2"/>
            <!-- lines -->
            <line class="line" x1="120" y1="120" x2="240" y2="170"/>
            <line class="line" x1="240" y1="170" x2="340" y2="110"/>
            <line class="line" x1="820" y1="210" x2="910" y2="140"/>
            <line class="line" x1="910" y1="140" x2="1020" y2="200"/>
          </g>
        </svg>
      </div>

      <div class="infocards" aria-hidden="true">
        <div class="pill">Anonymous ¬∑ no login</div>
        <div class="pill">Ephemeral ¬∑ 24h only</div>
        <div class="pill">Connection ¬∑ link similar moods</div>
      </div>
    </section>

    <!-- controls (left/right) -->
    <section class="controls" aria-label="controls">
      <section class="card" id="pulseCard">
        <h2 id="ui-pulseTitle">Pulse your mood</h2>

        <h3 id="ui-howFeel" style="margin-top:4px">How do you feel?</h3>
        <div id="moodPicker" class="row" aria-label="mood picker">
          <button type="button" data-mood="-2">üò≠</button>
          <button type="button" data-mood="-1">‚òπÔ∏è</button>
          <button type="button" data-mood="0">üòê</button>
          <button type="button" data-mood="1">üôÇ</button>
          <button type="button" data-mood="2">ü§©</button>
        </div>

        <div class="legend" aria-hidden="true">
          <span class="chip"><span class="dot" style="background:#8ebeff"></span>very low</span>
          <span class="chip"><span class="dot" style="background:#b5ccff"></span>low</span>
          <span class="chip"><span class="dot" style="background:#dee7ff"></span>neutral</span>
          <span class="chip"><span class="dot" style="background:#9bffdb"></span>good</span>
          <span class="chip"><span class="dot" style="background:#67ffb0"></span>great</span>
        </div>

        <div style="margin-top:12px">
          <div class="row">
            <strong id="ui-whatsHappening">What‚Äôs happening?</strong>
            <span id="ui-optional" class="help">(optional, 280 chars)</span>
          </div>
          <textarea id="note" placeholder="A few words you want to share..."></textarea>
        </div>

        <div class="row" style="margin-top:12px">
          <button id="useMyLocation" class="btn">Use my location</button>
          <span id="ui-orClickMap" class="help">or click on the map</span>
          <button id="toggleCrosshair" class="btn" type="button">Crosshair ‚ú¶</button>
        </div>

        <div class="help" style="margin-top:10px">
          <span id="chosenSpot">No spot selected yet.</span>
        </div>

        <label class="checkbox" style="margin-top:12px">
          <input id="connectConsent" type="checkbox" checked/>
          <span id="ui-allowConnect">Allow others to connect my dot</span>
        </label>

        <div class="row" style="margin-top:14px">
          <button id="submitMood" class="btn primary">Pulse</button>
          <button id="shareLink" class="btn" disabled>Share</button>
        </div>

        <p id="ui-postsInfo" class="help" style="margin-top:12px">
          Posts are anonymous and visible for 24 hours, then disappear.
        </p>

        <div class="row" style="margin-top:8px">
          <strong id="liveCount">Now: 0 pulses</strong>
          <canvas id="spark" width="160" height="34" style="display:block"></canvas>
        </div>
      </section>

      <section class="card" id="optionsCard">
        <h2>Map view</h2>

        <label class="checkbox">
          <input id="toggleConnections" type="checkbox"/>
          <span>Connect similar moods</span>
        </label>

        <div class="row" style="margin-top:8px">
          <strong id="ui-window">Window</strong>
          <select id="windowHours" class="btn" style="padding:8px 10px">
            <option value="6">6h</option>
            <option value="12">12h</option>
            <option value="24" selected>24h</option>
            <option value="48">48h</option>
          </select>
        </div>

        <div class="range" style="margin-top:10px">
          <strong id="ui-radius">Radius</strong>
          <input id="radiusKm" type="range" min="20" max="600" step="10" value="120"/>
          <span id="radiusValue" class="help">120km</span>
        </div>

        <div class="row" style="margin-top:10px">
          <label class="checkbox"><input id="toggleHeat" type="checkbox"/> <span>Heatmap</span></label>
          <label class="checkbox"><input id="toggleCluster" type="checkbox" checked/> <span>Cluster</span></label>
        </div>

        <p class="help" style="margin-top:8px">
          Tip: lower the window to 6‚Äì12h to see fresher activity.
        </p>

        <div class="infocards" style="margin-top:14px">
          <div class="pill"><strong>Anonymous</strong><br/>No login.</div>
          <div class="pill"><strong>Ephemeral</strong><br/>Dots glow 24h.</div>
          <div class="pill"><strong>Connection</strong><br/>Turn on links.</div>
        </div>
      </section>
    </section>

    <!-- map -->
    <section class="mapWrap">
      <div id="map" role="region" aria-label="map"></div>
      <div id="crosshair" class="hidden" aria-hidden="true"></div>
    </section>

    <!-- story / about -->
    <section id="about" class="story">
      <h2>About Micromoon</h2>
      <p>
        The same moon sees us all. Here, a feeling becomes a small light ‚Äî anonymous, gentle, and temporary.
        Lights gather and fade. Sometimes they connect. Sometimes they simply keep each other company.
      </p>
      <div class="steps">
        <div class="step"><h3>Why</h3><p>To make distance feel smaller. To notice what we share without asking for anything back.</p></div>
        <div class="step"><h3>How</h3><p>Pulse once. Add a few words if you want. Your dot glows for a day, then dissolves into the night.</p></div>
        <div class="step"><h3>Connection</h3><p>Turn on ‚Äúconnect similar‚Äù to draw quiet lines between close moods within your chosen radius.</p></div>
      </div>
      <p style="margin-top:10px">
        This is a small personal project by <strong>Mouaz Almjarkesh</strong> ‚Äî built to see if we still care about
        connection. Thank you for lighting the map.
      </p>
      <div class="footer">
        <span>¬© <span id="year"></span> Micromoon</span>
        <span>Built by <strong>Mouaz Almjarkesh</strong></span>
      </div>
    </section>
  </div>

  <!-- micro-interactions (visual only) -->
  <script>
    // footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // 3D tilt on cards (purely decorative)
    (function(){
      const cards=[document.getElementById('pulseCard'),document.getElementById('optionsCard')];
      const max=10; let rAF;
      function onMove(e,card){
        const r=card.getBoundingClientRect();
        const x=(e.clientX-r.left)/r.width-.5, y=(e.clientY-r.top)/r.height-.5;
        cancelAnimationFrame(rAF); rAF=requestAnimationFrame(()=>{card.style.transform=`rotateX(${-y*max}deg) rotateY(${x*max}deg)`;});
      }
      function reset(c){c.style.transform='rotateX(0) rotateY(0)';}
      cards.forEach(c=>{ if(!c) return; c.addEventListener('mousemove',ev=>onMove(ev,c)); c.addEventListener('mouseleave',()=>reset(c)); c.addEventListener('touchstart',()=>reset(c),{passive:true}); });
    })();

    // constellation mesh follows cursor (disabled with Reduce motion)
    (function(){
      const root=document.documentElement, mesh=document.getElementById('meshGroup'), motion=document.getElementById('toggleMotion');
      if(!mesh) return;
      let sx=0, sy=0;
      function move(e){
        if (document.body.classList.contains('reduce-motion')) return;
        const x=e.clientX/innerWidth-0.5, y=e.clientY/innerHeight-0.5;
        sx = x*12; sy = y*8;
        mesh.setAttribute('transform',`translate(${sx},${sy})`);
      }
      window.addEventListener('mousemove',move,{passive:true});
      motion && motion.addEventListener('change',()=>{ document.body.classList.toggle('reduce-motion', motion.checked); mesh.setAttribute('transform','translate(0,0)'); });
    })();
  </script>

  <!-- your app logic (unchanged) -->
  <script src="./app.js"></script>
</body>
</html>
